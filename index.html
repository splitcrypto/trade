<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SplitCrypto Trade</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #0c0c0c; color: #f0f0f0; text-align: center; padding: 20px; }
    h1 { color: #00ffa2; }
    button { margin: 8px; padding: 10px 18px; font-size: 16px; cursor: pointer; border: none; border-radius: 8px; background: #00ffa2; color: #000; font-weight: bold; }
    button:hover { background: #00cc80; }
    #msg { margin-top: 20px; min-height: 24px; font-size: 15px; color: #ff7070; }
  </style>
</head>
<body>
  <h1>SplitCrypto Trade</h1>
  <div>
    <button onclick="connectMetaMask()">ðŸ”— MetaMask</button>
    <button onclick="connectWalletConnect()">ðŸ”— WalletConnect</button>
  </div>

  <div>
    <button onclick="buy()">Buy</button>
    <button onclick="sell()">Sell</button>
  </div>

  <div id="msg"></div>

  <script>
    const CONTRACT_ADDRESS = "0x97D70031d9C64BD4C7AF7ee8CdbFE334B796966F";
    const WC_PROJECT_ID = "a38499ec874228017b4bf3f6d342dcb4";
    let provider, signer, contract;

    async function connectMetaMask(){
      try {
        if(!window.ethereum) return showMsg("MetaMask not found","error");
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.BrowserProvider(window.ethereum);
        setup("MetaMask");
      } catch(e){ showMsg("MetaMask error: "+e.message,"error"); }
    }

    async function connectWalletConnect(){
      try{
        const WalletConnectProvider = window.WalletConnectEthereumProvider;
        if(!WalletConnectProvider) {
          showMsg("WalletConnect not loaded","error");
          return;
        }

        const wc = await WalletConnectProvider.init({
          projectId: WC_PROJECT_ID,
          chains: [137],
          showQrModal: true,
          rpcMap: {137: "https://polygon-rpc.com"}
        });

        await wc.enable();
        provider = new ethers.BrowserProvider(wc);
        setup("WalletConnect");
      }catch(e){
        showMsg("WalletConnect error: "+(e.message||e),"error");
        console.error("WalletConnect error:", e);
      }
    }

    async function setup(type){
      signer = await provider.getSigner();
      contract = new ethers.Contract(CONTRACT_ADDRESS, [
        "function buy() external payable",
        "function sell(uint256 amount) external"
      ], signer);
      const addr = await signer.getAddress();
      showMsg(type + " connected: " + addr);
    }

    async function buy(){
      try{
        const tx = await contract.buy({ value: ethers.parseEther("0.001") });
        showMsg("Buy sent: "+tx.hash);
      }catch(e){ showMsg("Buy failed: "+(e.reason||e.message)); }
    }

    async function sell(){
      try{
        const tx = await contract.sell(ethers.parseEther("0.001"));
        showMsg("Sell sent: "+tx.hash);
      }catch(e){ showMsg("Sell failed: "+(e.reason||e.message)); }
    }

    function showMsg(m,type){
      const el=document.getElementById("msg");
      el.style.color = type==="error"?"#ff7070":"#00ffa2";
      el.innerText = m;
    }
  </script>

  <!-- âœ… Correct UMD build -->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.1/dist/umd/index.min.js"></script>
</body>
</html>
