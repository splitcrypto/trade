<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Free Money Coin (FREE) â€” Polygon</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7fbf7;
      --card: #ffffff;
      --accent: #1f9d63;
      --muted: #6b7280;
      --error: #e74c3c;
      --success: #1abc9c;
      font-family: Inter, system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: #0f172a; }
    header, footer {
      max-width: 960px; margin: 0 auto; padding: 16px;
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
    }
    .container { max-width: 960px; margin: 20px auto; padding: 16px; display: grid; gap: 16px; grid-template-columns: 1fr 360px; }
    .card { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .btn { background: var(--accent); color: #fff; border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-weight: 600; transition: opacity .15s; }
    .btn.secondary { background: #444; }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px,1fr)); gap: 8px; text-align: center; font-size: 13px; }
    .num { font-weight: 700; font-size: 16px; }
    .muted { color: var(--muted); font-size: 13px; }
    .input-group { display:flex; gap:8px; align-items:center; }
    input[type="number"], input[type="text"] { padding:8px; border-radius:8px; border:1px solid #ddd; width:100%; }
    .msg { max-width:960px; margin:10px auto; padding:10px 14px; border-radius:8px; display:none; }
    .msg.error { background:#fdecea; color:var(--error); display:block; }
    .msg.success { background:#e8f8f5; color:var(--success); display:block; }
    .msg.info { background:#eef2ff; color:#374151; display:block; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .param-row { display:flex; justify-content:space-between; gap:10px; padding:6px 0; font-size:14px; }
    .param-name { color:var(--muted); }
    @media(max-width:900px){ .container{ grid-template-columns:1fr } }
  </style>
</head>
<body>

<header>
  <h2>Free Money Coin (FREE) â€” Polygon</h2>
  <div>
    <button id="connectWeb3" class="btn">ðŸ”— Connect Wallet</button>
  </div>
</header>

<div id="messageBox" class="msg info">Welcome â€” connect your wallet to interact with Free Money Coin.</div>

<div class="container">
  <div>
    <div class="card">
      <div><strong>Address:</strong> <span id="address">â€”</span></div>
      <div><strong>Network:</strong> <span id="network">â€”</span></div>
      <hr>
      <div class="stats">
        <div><div class="num" id="yourBalance">â€”</div><div class="muted">Your FREE</div></div>
        <div><div class="num" id="totalSupply">â€”</div><div class="muted">Total Supply</div></div>
        <div><div class="num" id="vaultBalance">â€”</div><div class="muted">Vault</div></div>
        <div><div class="num" id="circulating">â€”</div><div class="muted">Circulating</div></div>
        <div><div class="num" id="canSell">â€”</div><div class="muted">Can Sell?</div></div>
      </div>

      <div style="margin-top:8px"><strong>Vault mint price:</strong> <span id="vaultSellPrice">â€”</span></div>
      <div style="margin-top:6px"><strong>Vault buyback price:</strong> <span id="buybackPrice">â€”</span></div>
      <div style="margin-top:6px"><strong>Public price range:</strong> <span id="minMaxPrice">â€”</span></div>
      <div style="margin-top:6px"><strong>Contract:</strong>
        <a id="contractLink" href="#" target="_blank" rel="noopener noreferrer">contract</a>
      </div>
    </div>

    <div class="card">
      <h3>Buy from Vault</h3>
      <div class="input-group" style="margin:8px 0;">
        <input id="buyAmount" type="number" placeholder="POL (MATIC)" min="0" step="any" />
        <button id="buyBtn" class="btn">Buy</button>
      </div>
      <div style="margin-top:8px; font-size:13px; color:var(--muted);">
        Minting is at the vault price (owner configurable). decimals = 0 (integer tokens).
      </div>
    </div>

    <div class="card">
      <h3>Sell to Vault (allowed amount)</h3>
      <div style="margin:8px 0;">
        <div class="muted">Vault sellback allowance:</div>
        <div style="display:flex;gap:8px;margin-top:6px;">
          <div style="flex:1"><div class="num" id="allowanceToSell">â€”</div></div>
          <div><button id="sellBtn" class="btn">Sell Allowed</button></div>
        </div>
      </div>
      <div style="margin-top:6px;font-size:13px;color:var(--muted);">Vault buyback buys up to (vaultSoldTo / 2) less prior reclaimed.</div>
    </div>
  </div>

  <div>
    <div class="card" id="ownerPanel" style="display:none">
      <h3>Owner Controls</h3>
      <div class="input-group" style="margin-bottom:8px;">
        <input id="minPriceInput" type="number" placeholder="min price (POL)" step="any">
        <input id="maxPriceInput" type="number" placeholder="max price (POL)" step="any">
      </div>
      <div class="input-group" style="margin-bottom:8px;">
        <input id="vaultSellInput" type="number" placeholder="vault sell price (POL)" step="any">
        <input id="buybackInput" type="number" placeholder="buyback price (POL)" step="any">
      </div>
      <div class="input-group" style="margin-bottom:8px;">
        <input id="maxMintInput" type="number" placeholder="max mintable (tokens)" step="1">
        <input id="secondHandBonusInput" type="number" placeholder="second-hand bonus (e.g., 1)" step="1">
      </div>
      <div style="display:flex;gap:8px;">
        <button id="setParamsBtn" class="btn">Set Params</button>
        <button id="withdrawPOLBtn" class="btn secondary">Withdraw POL</button>
        <button id="withdrawTokensBtn" class="btn secondary">Withdraw Tokens</button>
      </div>
    </div>

    <div class="card" id="publicParams" style="display:none">
      <h3>Parameters</h3>
      <div class="param-row"><div class="param-name">Min price</div><div id="p_min">â€”</div></div>
      <div class="param-row"><div class="param-name">Max price</div><div id="p_max">â€”</div></div>
      <div class="param-row"><div class="param-name">Vault sell price</div><div id="p_vaultSell">â€”</div></div>
      <div class="param-row"><div class="param-name">Buyback price</div><div id="p_buyback">â€”</div></div>
      <div class="param-row"><div class="param-name">Max mintable</div><div id="p_maxMint">â€”</div></div>
      <div class="param-row"><div class="param-name">Minted so far</div><div id="p_minted">â€”</div></div>
      <div class="param-row"><div class="param-name">2nd-hand bonus</div><div id="p_bonus">â€”</div></div>
    </div>
  </div>
</div>

<div class="card" style="max-width:960px;margin:20px auto;line-height:1.55;">
  <h2 style="color:var(--accent);margin-top:0;">A note from the creator</h2>
  <p>
    This is my third serious attempt at building a coin â€” and Iâ€™m proud of how Free Money Coin (FMC) has turned
    out. Iâ€™ve taken everything I learned from my earlier projects and built something I actually stand behind and
    can recommend putting money into.
  </p>
  <p>
    FMC is intentionally different. Rather than encouraging buy-and-hold, we reward closing positions quickly.
    The contract holds its own liquidity in a built-in vault (no external AMM required) so supply and instantly
    claimable liquidity remain aligned. Every POL sent in mints tokens directly from the vault, and the vault
    can buy back tokens at a fixed premium so you can lock in gains.
  </p>
  <p>
    Two problems I wanted to fix were centralization of liquidity services and the disconnect between a coinâ€™s
    stated value and how much real cash is available to back it. FMCâ€™s vault model mints tokens as investors add
    POL so that supply more closely tracks real, redeemable liquidity.
  </p>
  <p>
    The trading model is novel: a secondary market buyer effectively funds a previous holderâ€™s exit, and the vault
    mints a bonus to the new buyer, often giving them an even better effective entry price. The system encourages
    fast, community-driven turnover rather than long, speculative holding.
  </p>
  <p>
    Below are the broad rules and mechanics (brief). If youâ€™re here to participate: read, understand, and trade
    responsibly â€” and donâ€™t let anyone tell you thereâ€™s no such thing as free money!
  </p>
</div>

<footer class="muted" style="text-align:center; padding:18px 0;">
  Built for Free Money Coin â€” Polygon Network
</footer>

<!-- Ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>

<script>
/* ====== CONFIG - update CONTRACT_ADDRESS ====== */
const CONTRACT_ADDRESS = "PUT_YOUR_CONTRACT_ADDRESS_HERE";
/* ABI: only the functions/events used by this front-end */
const ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function totalSupply() view returns (uint256)",
  "function vault() view returns (address)",
  "function minPriceWei() view returns (uint256)",
  "function maxPriceWei() view returns (uint256)",
  "function vaultSellPriceWei() view returns (uint256)",
  "function buybackPriceWei() view returns (uint256)",
  "function maxMintableFromVault() view returns (uint256)",
  "function mintedFromVault() view returns (uint256)",
  "function secondHandBonus() view returns (uint256)",
  "function vaultBuybackAllowance(address) view returns (uint256)",
  "function vaultSoldTo(address) view returns (uint256)",
  "function buyTokens() payable",
  "function buyFromSeller(address,uint256) payable",
  "function sellToVault(uint256)",
  "function withdrawPOL(uint256)",
  "function withdrawTokens(uint256)",
  "function setMinMaxPriceWei(uint256,uint256)",
  "function setBuybackPriceWei(uint256)",
  "function setVaultSellPriceWei(uint256)",
  "function setMaxMintableFromVault(uint256)",
  "function setSecondHandBonus(uint256)",
  "function owner() view returns (address)",
  "event TokensMinted(address,uint256,uint256)",
  "event BoughtFromSeller(address,address,uint256,uint256,uint256,uint256)",
  "event SoldToVault(address,uint256,uint256)"
];

let provider, signer, contract;
const msgBox = document.getElementById("messageBox");
function showMsg(text, type="info") {
  msgBox.textContent = text;
  msgBox.className = "msg " + type;
  msgBox.style.display = "block";
}

function short(addr) { return addr.slice(0,6) + "..." + addr.slice(-4); }

async function loadPublicParams() {
  try {
    const rpc = new ethers.JsonRpcProvider("https://polygon-rpc.com");
    const c = new ethers.Contract(CONTRACT_ADDRESS, ABI, rpc);
    const [vaultAddr, minP, maxP, vaultSell, buyback, maxMint, minted, bonus] = await Promise.all([
      c.vault(),
      c.minPriceWei(),
      c.maxPriceWei(),
      c.vaultSellPriceWei(),
      c.buybackPriceWei(),
      c.maxMintableFromVault(),
      c.mintedFromVault(),
      c.secondHandBonus()
    ]);
    document.getElementById("contractLink").href = "https://polygonscan.com/address/" + CONTRACT_ADDRESS;
    document.getElementById("p_min").textContent = Number(ethers.formatUnits(minP,18)).toString() + " MATIC";
    document.getElementById("p_max").textContent = Number(ethers.formatUnits(maxP,18)).toString() + " MATIC";
    document.getElementById("p_vaultSell").textContent = Number(ethers.formatUnits(vaultSell,18)).toString() + " MATIC";
    document.getElementById("p_buyback").textContent = Number(ethers.formatUnits(buyback,18)).toString() + " MATIC";
    document.getElementById("p_maxMint").textContent = maxMint.toString();
    document.getElementById("p_minted").textContent = minted.toString();
    document.getElementById("p_bonus").textContent = bonus.toString();
    document.getElementById("p_min").dataset.raw = minP.toString();
    document.getElementById("p_max").dataset.raw = maxP.toString();
  } catch(e) {
    // ignore
  }
}
loadPublicParams();

/* CONNECT */
async function connectWeb3(){
  if (!window.ethereum) {
    return showMsg("Please install MetaMask or another Web3 wallet.","error");
  }
  try {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
    const addr = await signer.getAddress();
    document.getElementById("address").textContent = short(addr);
    document.getElementById("network").textContent = "Polygon (chain 137)";
    document.getElementById("connectWeb3").textContent = "ðŸ”— Connected";
    document.getElementById("connectWeb3").disabled = true;

    const owner = await contract.owner().catch(()=>null);
    if (owner && owner.toLowerCase() === addr.toLowerCase()) {
      // show owner panel
      document.getElementById("ownerPanel").style.display = "block";
      document.getElementById("publicParams").style.display = "none";
    } else {
      document.getElementById("ownerPanel").style.display = "none";
      document.getElementById("publicParams").style.display = "block";
    }

    showMsg("Wallet connected: " + short(addr), "success");
    fetchData();
    // subscribe to events to update UI
    contract.on("TokensMinted", fetchData);
    contract.on("BoughtFromSeller", fetchData);
    contract.on("SoldToVault", fetchData);
  } catch(e) {
    showMsg("Connection failed: " + (e.message || e), "error");
  }
}

/* FETCH DATA */
async function fetchData(){
  if (!contract) return;
  try {
    const addr = await signer.getAddress();
    const vaultAddr = await contract.vault();
    const [yourBal, totalSup, vaultBal, vaultSellPrice, buybackPrice, minP, maxP, minted, maxMint, bonus, vaultAllowance] = await Promise.all([
      contract.balanceOf(addr),
      contract.totalSupply(),
      contract.balanceOf(vaultAddr),
      contract.vaultSellPriceWei(),
      contract.buybackPriceWei(),
      contract.minPriceWei(),
      contract.maxPriceWei(),
      contract.mintedFromVault(),
      contract.maxMintableFromVault(),
      contract.secondHandBonus(),
      contract.vaultBuybackAllowance(addr)
    ]);

    // decimals = 0 for token units
    document.getElementById("yourBalance").textContent = yourBal.toString();
    document.getElementById("totalSupply").textContent = totalSup.toString();
    document.getElementById("vaultBalance").textContent = vaultBal.toString();
    const circ = (BigInt(totalSup) - BigInt(vaultBal)).toString();
    document.getElementById("circulating").textContent = circ;
    // Can sell?
    document.getElementById("canSell").textContent = (BigInt(vaultAllowance) > 0n) ? "âœ… Yes" : "âŒ No";
    // Prices
    document.getElementById("vaultSellPrice").textContent = Number(ethers.formatUnits(vaultSellPrice,18)).toString() + " MATIC";
    document.getElementById("buybackPrice").textContent = Number(ethers.formatUnits(buybackPrice,18)).toString() + " MATIC";
    document.getElementById("minMaxPrice").textContent = Number(ethers.formatUnits(minP,18)).toString() + " â€” " + Number(ethers.formatUnits(maxP,18)).toString() + " MATIC";
    // contract link
    document.getElementById("contractLink").href = "https://polygonscan.com/address/" + CONTRACT_ADDRESS;
    // allowance to sell (display)
    document.getElementById("allowanceToSell").textContent = vaultAllowance.toString();

    // fill public params (for non-owner view)
    document.getElementById("p_min").textContent = Number(ethers.formatUnits(minP,18)).toString() + " MATIC";
    document.getElementById("p_max").textContent = Number(ethers.formatUnits(maxP,18)).toString() + " MATIC";
    document.getElementById("p_vaultSell").textContent = Number(ethers.formatUnits(vaultSellPrice,18)).toString() + " MATIC";
    document.getElementById("p_buyback").textContent = Number(ethers.formatUnits(buybackPrice,18)).toString() + " MATIC";
    document.getElementById("p_maxMint").textContent = maxMint.toString();
    document.getElementById("p_minted").textContent = minted.toString();
    document.getElementById("p_bonus").textContent = bonus.toString();

  } catch(e) {
    showMsg("Error fetching data: " + (e.message || e), "error");
  }
}

/* UI ACTIONS */

// Buy from vault
document.getElementById("buyBtn").onclick = async () => {
  if (!contract) return showMsg("Connect wallet first","error");
  try {
    const val = Number(document.getElementById("buyAmount").value);
    if (!val || val <= 0) return showMsg("Enter POL amount to buy","error");
    const tx = await contract.buyTokens({ value: ethers.parseUnits(String(val), 18) });
    showMsg("Submitting buy transaction...", "info");
    await tx.wait();
    showMsg("Buy successful", "success");
    fetchData();
  } catch(e) {
    showMsg("Buy failed: " + (e?.reason || e?.message || e), "error");
  }
};

// Sell to vault (sell allowed)
document.getElementById("sellBtn").onclick = async () => {
  if (!contract) return showMsg("Connect wallet first","error");
  try {
    const addr = await signer.getAddress();
    const allowance = await contract.vaultBuybackAllowance(addr);
    const can = BigInt(allowance);
    if (can === 0n) return showMsg("No vault allowance to sell","error");
    // sell the allowed amount
    const tx = await contract.sellToVault(allowance);
    showMsg("Submitting sell transaction...", "info");
    await tx.wait();
    showMsg("Sell successful", "success");
    fetchData();
  } catch(e) {
    showMsg("Sell failed: " + (e?.reason || e?.message || e), "error");
  }
};

// Owner: Set params
document.getElementById("setParamsBtn").onclick = async () => {
  if (!contract) return showMsg("Connect wallet first","error");
  try {
    const min = document.getElementById("minPriceInput").value;
    const max = document.getElementById("maxPriceInput").value;
    const vSell = document.getElementById("vaultSellInput").value;
    const buyback = document.getElementById("buybackInput").value;
    const maxMint = document.getElementById("maxMintInput").value;
    const bonus = document.getElementById("secondHandBonusInput").value;

    if (!min || !max) return showMsg("Enter min and max prices", "error");
    // setMinMaxPriceWei(min,max)
    const tx1 = await contract.setMinMaxPriceWei(ethers.parseUnits(String(min),18), ethers.parseUnits(String(max),18));
    showMsg("Setting min/max...", "info");
    await tx1.wait();

    if (vSell) {
      const tx2 = await contract.setVaultSellPriceWei(ethers.parseUnits(String(vSell),18));
      await tx2.wait();
    }
    if (buyback) {
      const tx3 = await contract.setBuybackPriceWei(ethers.parseUnits(String(buyback),18));
      await tx3.wait();
    }
    if (maxMint) {
      const tx4 = await contract.setMaxMintableFromVault( BigInt(maxMint) );
      await tx4.wait();
    }
    if (bonus) {
      const tx5 = await contract.setSecondHandBonus( BigInt(bonus) );
      await tx5.wait();
    }
    showMsg("Parameters updated", "success");
    fetchData();
  } catch(e) {
    showMsg("Setting params failed: " + (e?.reason || e?.message || e), "error");
  }
};

// Owner: withdraw POL (amount typed into buyAmount input for convenience)
document.getElementById("withdrawPOLBtn").onclick = async () => {
  if (!contract) return showMsg("Connect wallet first","error");
  try {
    const amt = Number(document.getElementById("buyAmount").value);
    if (!amt || amt <= 0) return showMsg("Enter POL amount to withdraw (in POL)", "error");
    const tx = await contract.withdrawPOL(ethers.parseUnits(String(amt),18));
    showMsg("Withdrawing POL...", "info");
    await tx.wait();
    showMsg("Withdraw complete", "success");
    fetchData();
  } catch(e) {
    showMsg("Withdraw failed: " + (e?.reason || e?.message || e), "error");
  }
};

// Owner: withdraw tokens from vault (uses buyAmount input as token amount)
document.getElementById("withdrawTokensBtn").onclick = async () => {
  if (!contract) return showMsg("Connect wallet first","error");
  try {
    const amt = Number(document.getElementById("buyAmount").value);
    if (!amt || amt <= 0) return showMsg("Enter token amount to withdraw", "error");
    const tx = await contract.withdrawTokens(BigInt(amt));
    showMsg("Withdrawing tokens...", "info");
    await tx.wait();
    showMsg("Token withdraw complete", "success");
    fetchData();
  } catch(e) {
    showMsg("Token withdraw failed: " + (e?.reason || e?.message || e), "error");
  }
};

/* Wire up connect button */
document.getElementById("connectWeb3").onclick = connectWeb3;

/* Polling updates */
setInterval(()=> {
  if (contract) fetchData(); else loadPublicParams();
}, 15000);
</script>
</body>
</html>
