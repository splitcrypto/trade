<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SplitCoin (SPLI) â€” Polygon</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7fbf7;
      --card: #ffffff;
      --accent: #1f9d63;
      --muted: #6b7280;
      font-family: Inter, system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: #0f172a; }
    header, footer {
      max-width: 960px; margin: 0 auto; padding: 16px;
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
    }
    .container { max-width: 960px; margin: 20px auto; padding: 16px; display: grid; gap: 16px; grid-template-columns: 1fr 340px; }
    .card { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .btn { background: var(--accent); color: #fff; border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-weight: 600; transition: opacity .15s; }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px,1fr)); gap: 8px; text-align: center; font-size: 13px; }
    .num { font-weight: 700; font-size: 16px; }
    .muted { color: var(--muted); font-size: 13px; }
    .input-group { display:flex; gap:8px; align-items:center; }
    input[type="number"] { padding:8px; border-radius:8px; border:1px solid #ddd; width:100%; }
    @media(max-width:800px){ .container{ grid-template-columns:1fr } }
  </style>
</head>
<body>

<header>
  <h2>SplitCoin (SPLI) â€” Polygon</h2>
  <div>
    <button id="connectMetaMask" class="btn">ðŸ¦Š MetaMask</button>
    <button id="connectWC" class="btn">ðŸ”— WalletConnect</button>
  </div>
</header>

<div class="container">
  <div>
    <div class="card">
      <div><strong>Address:</strong> <span id="address">â€”</span></div>
      <div><strong>Network:</strong> <span id="network">â€”</span></div>
      <hr>
      <div class="stats">
        <div><div class="num" id="yourBalance">â€”</div><div>Your SPLI</div></div>
        <div><div class="num" id="totalSupply">â€”</div><div>Total Supply</div></div>
        <div><div class="num" id="vaultBalance">â€”</div><div>Vault</div></div>
        <div><div class="num" id="circulating">â€”</div><div>Circulating</div></div>
        <div><div class="num" id="canSell">â€”</div><div>Can Sell?</div></div>
      </div>
      <div style="margin-top:8px"><strong>Price:</strong> <span id="currentPrice">â€”</span></div>
    </div>

    <div class="card">
      <h3>Buy SPLI</h3>
      <div class="input-group" style="margin:8px 0;">
        <input id="buyAmount" type="number" placeholder="Amount" min="0" step="any" />
        <div style="font-weight:600">POL (MATIC)</div>
      </div>
      <button id="buyBtn" class="btn">Buy</button>
    </div>
  </div>

  <div>
    <div class="card">
      <h3>Sell SPLI</h3>
      <button id="sellBtn" class="btn">Sell All</button>
    </div>

    <div class="card" id="devMenu" style="display:none">
      <h3>Developer Menu</h3>
      <button class="btn" id="enableTradingBtn">Enable Trading</button>
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn" id="unpauseBtn">Unpause</button>
      <button class="btn" id="withdrawAllBtn">Withdraw All POL</button>
    </div>
  </div>
</div>

<div class="card" style="max-width:960px;margin:20px auto;line-height:1.55;">
  <h2 style="color:var(--accent);margin-top:0;">About SplitCoin (SPLI)</h2>

  <p><strong>Our Vision:</strong> When we make money, you make money too! SplitCoin brings people together to profit from quick, strategic moves. Each purchase instantly locks in a 25% profit â€” your position will never be worth less, but will also never be worth more. The vault burns an equal amount of tokens with every purchase to maintain supply control and stabilize price. The goal becomes to cash out as quickly as possible, which can happen as soon as another purchase is made by someone else. Once you sell, you can buy in again, aiming for the next fast cashout. This model rewards speed, strategy, and participation in the community-driven liquidity cycle.</p>

  <p><strong>Mechanics:</strong> SplitCoin (SPLI) is a novel approach to asset trading. Typically, stocks or crypto are held for long periods while value slowly increases. With SPLI, buying a token instantly locks in a 25% profit â€” your position will never be worth less, but will also never be worth more. The vault burns an equal amount of tokens with every purchase to maintain supply control and stabilize price. The goal becomes to cash out as quickly as possible, which can happen as soon as another purchase is made by someone else. Once you sell, you can buy in again.</p>

  <ul>
    <li>Buy SPLI to lock in a guaranteed 25% gain instantly.</li>
    <li>No trading between holders â€” only to and from the vault.</li>
    <li>Full exits only: sell your entire position.</li>
    <li>Single entry per cycle: must sell before buying again.</li>
    <li>Liquidity protections prevent draining or abuse.</li>
    <li>Owner may provide additional liquidity if needed.</li>
  </ul>
</div>

<footer class="muted" style="text-align:center; padding:18px 0;">
  Built for SplitCoin â€” Polygon Network
</footer>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.1/dist/index.min.js"></script>

<script>
const CONTRACT_ADDRESS = "0x97D70031d9C64BD4C7AF7ee8CdbFE334B796966F";
const ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function totalSupply() view returns (uint256)",
  "function vault() view returns (address)",
  "function currentPrice() view returns (uint256)",
  "function totalPurchases() view returns (uint256)",
  "function purchaseIndex(address) view returns (uint256)",
  "function buyTokens() payable",
  "function sellTokens(uint256)",
  "function owner() view returns(address)",
  "function enableTrading(bool)",
  "function pause()",
  "function unpause()",
  "function withdrawAllPOL()",
  "event TokensPurchased(address,uint256,uint256,uint256)",
  "event TokensSold(address,uint256,uint256,uint256)"
];

const WC_PROJECT_ID = "a38499ec874228017b4bf3f6d342dcb4";

let provider, signer, contract;

function short(addr){ return addr.slice(0,6)+"..."+addr.slice(-4); }

async function connectMetaMask(){
  if(!window.ethereum) return alert("Install MetaMask");
  await ethereum.request({ method:"eth_requestAccounts" });
  provider = new ethers.BrowserProvider(window.ethereum);
  setup();
}

async function connectWalletConnect(){
  const WalletConnectProvider =
    window.WalletConnectEthereumProvider ??
    window.WalletConnectProvider?.default;

  const wc = await WalletConnectProvider.init({
    projectId: WC_PROJECT_ID,
    chains: [137],
    showQrModal: true,
    rpcMap: { 137: "https://polygon-rpc.com" }
  });

  await wc.enable();
  provider = new ethers.BrowserProvider(wc);
  setup();
}

async function setup(){
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  const addr = await signer.getAddress();
  document.getElementById("address").textContent = short(addr);
  document.getElementById("network").textContent = "Polygon (chain 137)";

  try { if((await contract.owner()).toLowerCase() === addr.toLowerCase()) document.getElementById("devMenu").style.display="block"; } catch(e){}

  fetchData();
  contract.on("TokensPurchased", fetchData);
  contract.on("TokensSold", fetchData);
}

async function fetchData(){
  const addr = await signer.getAddress();
  const vaultAddr = await contract.vault();
  const [b,y,v,p,tp,pi] = await Promise.all([
    contract.balanceOf(addr),
    contract.totalSupply(),
    contract.balanceOf(vaultAddr),
    contract.currentPrice(),
    contract.totalPurchases(),
    contract.purchaseIndex(addr)
  ]);

  document.getElementById("yourBalance").textContent = Number(ethers.formatUnits(b,18)).toFixed(4);
  document.getElementById("totalSupply").textContent = Number(ethers.formatUnits(y,18)).toFixed(2);
  document.getElementById("vaultBalance").textContent = Number(ethers.formatUnits(v,18)).toFixed(2);
  document.getElementById("circulating").textContent = Number(ethers.formatUnits(y-v,18)).toFixed(2);
  document.getElementById("currentPrice").textContent = Number(ethers.formatUnits(p,18))+" MATIC";
  document.getElementById("canSell").textContent = tp > pi ? "âœ… Yes" : "âŒ No";
}

document.getElementById("connectMetaMask").onclick = connectMetaMask;
document.getElementById("connectWC").onclick = connectWalletConnect;

document.getElementById("buyBtn").onclick = async()=>{
  const val = Number(buyAmount.value);
  if(!val) return;
  const tx = await contract.buyTokens({ value: ethers.parseUnits(String(val),18) });
  await tx.wait(); fetchData();
};

document.getElementById("sellBtn").onclick = async()=>{
  const amt = await contract.balanceOf(await signer.getAddress());
  if(amt == 0n) return alert("No SPLI");
  const tx = await contract.sellTokens(amt);
  await tx.wait(); fetchData();
};

enableTradingBtn.onclick = async()=>{ await (await contract.enableTrading(true)).wait(); };
pauseBtn.onclick = async()=>{ await (await contract.pause()).wait(); };
unpauseBtn.onclick = async()=>{ await (await contract.unpause()).wait(); };
withdrawAllBtn.onclick = async()=>{ await (await contract.withdrawAllPOL()).wait(); };

setInterval(()=>{ if(contract) fetchData(); },15000);
</script>
</body>
</html>
